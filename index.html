<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>注文</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      margin: 0 0 10px;
      font-size: 32px;
    }

    h3 {
      margin: 18px 0 10px;
      font-size: 20px;
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      background: #eee;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .menu-button {
      width: 100%;
      padding: 16px;
      margin-bottom: 10px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #000;
      color: #fff;
      cursor: pointer;
    }

    .order-box {
      margin-top: 10px;
      font-size: 16px;
    }

    .total {
      font-weight: bold;
      margin-top: 10px;
      font-size: 18px;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      margin-top: 16px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #000;
      color: #fff;
      cursor: pointer;
    }

    .clear-btn {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>注文</h1>
    <p>※このQRコードは固定です【毎日更新しません】</p>

    <p id="table">テーブル番号：未指定</p>
    <span id="status" class="status">入力中</span>

    <h3>メニュー</h3>

    <button class="menu-button" onclick="addItem(1)">唐揚げ（600円）</button>
    <button class="menu-button" onclick="addItem(2)">ポテト（450円）</button>
    <button class="menu-button" onclick="addItem(3)">生ビール（700円）</button>

    <h3>注文内容</h3>
    <div id="order" class="order-box"></div>
    <div id="total" class="total">合計：0 円</div>

    <button class="submit-btn" onclick="submitOrder()">注文する</button>
    <button class="clear-btn" onclick="clearOrder()">カートを空にする</button>
  </div>

  <script>
    // ===============================
    // Google Apps Script Webアプリ URL（設定済み）
    // ===============================
    const APPS_SCRIPT_URL =
      "https://script.google.com/macros/s/AKfycbxuXfWIuKj2ZOGA_EvEGNzS6-nepQa72oRHKdEV5viiFxixkMu8_ZLhOtg7deGxdp0_xQ/exec";

    // ===============================
    // テーブル番号取得
    // ===============================
    const params = new URLSearchParams(location.search);
    const table = params.get("table") || "未指定";
    document.getElementById("table").textContent = "テーブル番号： " + table;

    const statusEl = document.getElementById("status");

    // ===============================
    // 商品データ
    // ===============================
    const products = [
      { id: 1, name: "唐揚げ", price: 600 },
      { id: 2, name: "ポテト", price: 450 },
      { id: 3, name: "生ビール", price: 700 }
    ];

    let cart = [];

    function addItem(id) {
      cart.push(products.find(p => p.id === id));
      render();
    }

    function clearOrder() {
      cart = [];
      render();
    }

    function render() {
      const orderEl = document.getElementById("order");
      orderEl.innerHTML = "";

      let total = 0;
      cart.forEach(item => {
        const div = document.createElement("div");
        div.textContent = `${item.name}（${item.price}円）`;
        orderEl.appendChild(div);
        total += item.price;
      });

      document.getElementById("total").textContent =
        `合計：${total} 円`;
    }

    async function submitOrder() {
      if (cart.length === 0) return;

      statusEl.textContent = "送信中…";

      const payload = {
        table: table,
        items: cart.map(i => i.name).join(" , "),
        total: cart.reduce((s, i) => s + i.price, 0)
      };

      try {
        const res = await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error();

        alert("注文を送信しました");
        statusEl.textContent = "送信完了";
        clearOrder();
      } catch (e) {
        alert("送信に失敗しました。通信状況を確認してください。");
        statusEl.textContent = "送信失敗";
      }
    }
  </script>
</body>
</html>
